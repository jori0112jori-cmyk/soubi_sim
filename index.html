<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ãƒ©ã‚¹ãƒˆã‚¦ã‚©ãƒ¼è‚²æˆãƒ»åˆ¤å®šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
<style>
    /* å…¨ä½“ã®ãƒ™ãƒ¼ã‚¹è¨­å®š */
    body { font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif; background-color: #f0f4f8; color: #333; padding: 12px 10px; padding-bottom: 100px; margin: 0; font-size: 16px; }
    h1 { font-size: 1.4rem; text-align: center; color: #2c3e50; margin-bottom: 18px; line-height: 1.4; font-weight: 900; letter-spacing: 0.5px;}
    .container { max-width: 1000px; margin: 0 auto; }
    
    /* ã‚¿ãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
    .tabs { display: flex; background: #e1e8ed; border-radius: 12px; padding: 4px; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px; }
    .tab-btn { flex: 1; padding: 14px 0; text-align: center; font-size: 1.05rem; font-weight: 900; color: #7f8c8d; cursor: pointer; transition: all 0.3s ease; border-radius: 8px; }
    .tab-btn.active { background: #fff; color: #2980b9; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .tab-content { display: none; animation: fadeIn 0.3s ease; }
    .tab-content.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

    /* ãƒ‘ãƒãƒ«ã¨ã‚«ãƒ¼ãƒ‰ã®åŸºæœ¬è¨­å®š */
    .panel { background: #fff; padding: 18px 15px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.06); margin-bottom: 18px; }
    .panel-header { display: flex; justify-content: space-between; align-items: center; margin-top: 0; color: #2980b9; border-bottom: 2px solid #ecf0f1; padding-bottom: 10px; font-size: 1.15rem; margin-bottom: 15px; font-weight: 900;}
    .reset-btn { font-size: 0.8rem; background: #f2f4f6; color: #7f8c8d; border: 1px solid #ccd1d9; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s;}
    .reset-btn:active { background: #e1e8ed; }
    
    /* ã‚¹ãƒ†ãƒƒãƒ‘ãƒ¼ãƒ»å…¥åŠ›é–¢é€£ */
    label { display: block; margin-top: 5px; margin-bottom: 6px; font-weight: 900; font-size: 0.95rem; color: #444; }
    .stepper { display: flex; align-items: center; background: #fff; border: 1px solid #ccd1d9; border-radius: 8px; overflow: hidden; height: 38px; width: 100%; box-sizing: border-box; box-shadow: inset 0 1px 2px rgba(0,0,0,0.02);}
    .stepper button { width: 40px; height: 100%; border: none; background: #f2f4f6; font-size: 1.5rem; font-weight: bold; color: #34495e; cursor: pointer; touch-action: manipulation; flex-shrink: 0; transition: background 0.1s; }
    .stepper button:active { background: #dce1e6; }
    .stepper input { flex: 1; width: 100%; min-width: 0; text-align: center; border: none; font-size: 1.1rem; font-weight: 900; color: #2c3e50; background: transparent; height: 100%; padding: 0; }
    .stepper input[readonly] { font-size: 0.9rem; letter-spacing: -1.5px; }

    /* ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆç”¨ã®ã‚¯ãƒ©ã‚¹ */
    .stepper.disabled { opacity: 0.4; pointer-events: none; background-color: #ecf0f1; }

    /* éƒ¨éšŠç·¨æˆç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .squad-section { margin-bottom: 18px; border: 2px solid #e1e8ed; border-radius: 10px; overflow: hidden; background: #fff;}
    .squad-header { background: linear-gradient(to right, #f8f9fa, #eef2f5); padding: 14px 15px; font-weight: 900; color: #2c3e50; display: flex; justify-content: space-between; align-items: center; cursor: pointer; font-size: 1.1rem;}
    .squad-body { padding: 15px 12px; display: none; }
    .squad-body.open { display: block; }
    .hero-slot { display: flex; gap: 8px; margin-bottom: 12px; align-items: center; background: #fafbfc; padding: 10px; border-radius: 8px; border: 1px solid #f0f2f5; }
    .hero-select { flex: 2; padding: 10px 6px; border-radius: 6px; border: 1px solid #ccd1d9; font-size: 1rem; font-weight: bold; color: #333; background: #fff;}
    .wp-input-wrap { flex: 1; display: flex; align-items: center; gap: 6px; }
    
    /* é™£å½¢ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ« */
    .form-visual-row { display: flex; justify-content: center; gap: 10px; margin-bottom: 12px; }
    .hero-box { padding: 10px 4px; border-radius: 8px; width: 31%; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: 0 3px 6px rgba(0,0,0,0.08); line-height: 1.3; border: 1px solid;}
    
    .hero-tank { background: linear-gradient(135deg, #fef5e7, #fdebd0); border-color: #fad7a1; }
    .hero-air { background: linear-gradient(135deg, #ebf5fb, #d6eaf8); border-color: #aed6f1; }
    .hero-mis { background: linear-gradient(135deg, #fdedec, #fadbd8); border-color: #f5b7b1; }
    .hero-none { background: #f4f6f7; border-color: #e5e8e8; color: #999; }
    
    .type-badge { color: #fff; padding: 3px 6px; border-radius: 4px; font-size: 0.75rem; margin-bottom: 5px; font-weight: 900; letter-spacing: 0.5px;}
    .bg-tank { background-color: #e67e22; }
    .bg-air { background-color: #2980b9; }
    .bg-mis { background-color: #c0392b; }
    .hero-name { font-size: 0.95rem; font-weight: 900; color: #2c3e50; margin-bottom: 4px; }
    
    .advice-box { font-size: 0.95rem; background: #fffbf2; padding: 15px; border-radius: 8px; border-left: 5px solid #f39c12; margin-top: 18px; line-height: 1.6; color: #444; font-weight: bold;}
    .advice-err { border-left-color: #e74c3c; background: #fdedec; color: #a93226; }
    .advice-ok { border-left-color: #27ae60; background: #eafaf1; color: #1e8449; }

    /* è£…å‚™ã‚·ãƒŸãƒ¥ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    .grid { display: flex; gap: 15px; flex-wrap: wrap; }
    .card { flex: 1; min-width: 100%; background: #fff; padding: 18px 15px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.06); box-sizing: border-box;}
    @media (min-width: 768px) { .card { min-width: calc(50% - 15px); padding: 20px 15px; } }
    .card-before { border-top: 6px solid #7f8c8d; }
    .card-after { border-top: 6px solid #e74c3c; }
    .gear-row { display: grid; grid-template-columns: 1.1fr 1fr; gap: 12px; margin-bottom: 10px; align-items: end; }
    
    .result { margin-top: 20px; padding: 18px; border-radius: 10px; text-align: center; border: 1px solid #e1e8ed; background-color: #f8f9fa;}
    .res-after { background-color: #faeaeb; border-color: #fadbd8; }
    .score { font-size: 2.6rem; font-weight: 900; margin: 8px 0; font-family: "Arial Black", Arial, sans-serif; letter-spacing: 1px;}
    .score-b { color: #2980b9; } .score-a { color: #c0392b; }
    .mythic-box { margin-top: 10px; padding-top: 10px; border-top: 1px dashed #e74c3c; text-align: left; font-size: 0.85rem; line-height: 1.6; color: #333;}
    
    /* ãƒ•ãƒƒã‚¿ãƒ¼ */
    .diff-wrapper { position: fixed; bottom: 12px; left: 50%; transform: translateX(-50%); width: calc(100% - 24px); max-width: 970px; z-index: 1000; }
    .diff { font-size: 1.2rem; color: #e74c3c; font-weight: 900; text-align: center; padding: 12px; background: rgba(255, 250, 250, 0.96); backdrop-filter: blur(8px); border-radius: 12px; border: 2px solid #fadbd8; box-shadow: 0 6px 16px rgba(231, 76, 60, 0.15); line-height: 1.5;}
</style>
</head>
<body>

<div class="container">
    <h1>è‚²æˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼<br><span style="font-size: 0.9rem; color: #7f8c8d;"></span></h1>

    <div class="tabs">
        <div class="tab-btn active" onclick="switchTab('squadTab')">âš”ï¸ éƒ¨éšŠç·¨æˆãƒ»åˆ¤å®š</div>
        <div class="tab-btn" onclick="switchTab('gearTab')">ğŸ›¡ï¸ è£…å‚™ã‚·ãƒŸãƒ¥</div>
    </div>

    <div id="squadTab" class="tab-content active">
        <div class="panel">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <label style="margin:0; font-size: 1.1rem;">ğŸ“‹ éƒ¨éšŠç·¨æˆã¨åˆ¤å®š</label>
                <button class="reset-btn" onclick="resetSquads()">ğŸ”„ ç·¨æˆãƒªã‚»ãƒƒãƒˆ</button>
            </div>
            <div id="squadContainer"></div>
        </div>
    </div>

    <div id="gearTab" class="tab-content">
        <div class="grid">
            <div class="card card-before">
                <h3 class="panel-header" style="color:#7f8c8d;">ç¾åœ¨ã®è£…å‚™ãƒ»ãƒãƒ•</h3>
                <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px dashed #e1e8ed;">
                    <label>âš”ï¸ ç¾åœ¨ã®å°‚ç”¨æ­¦è£… Lv (0ã€œ30)</label>
                    <div class="stepper"><button onclick="step('cWeapon', -1)">-</button><input type="number" id="cWeapon" value="20" min="0" max="30" onchange="calculate()"><button onclick="step('cWeapon', 1)">+</button></div>
                </div>
                <div class="gear-row">
                    <div><label>ğŸ”« ãƒ¬ãƒ¼ãƒ«ã‚¬ãƒ³ Lv</label><div class="stepper"><button onclick="step('cGunLv', -1)">-</button><input type="number" id="cGunLv" value="40" min="0" max="40" onchange="calculate()"><button onclick="step('cGunLv', 1)">+</button></div></div>
                    <div><label>â˜…</label><div class="stepper"><button onclick="step('cGunStar', -1)">-</button><input type="text" id="cGunStar" data-val="0" value="â˜†â˜†â˜†â˜†â˜†" readonly><button onclick="step('cGunStar', 1)">+</button></div></div>
                </div>
                <div class="gear-row">
                    <div><label>ğŸ’¾ ãƒãƒƒãƒ— Lv</label><div class="stepper"><button onclick="step('cDataLv', -1)">-</button><input type="number" id="cDataLv" value="40" min="0" max="40" onchange="calculate()"><button onclick="step('cDataLv', 1)">+</button></div></div>
                    <div><label>â˜…</label><div class="stepper"><button onclick="step('cDataStar', -1)">-</button><input type="text" id="cDataStar" data-val="0" value="â˜†â˜†â˜†â˜†â˜†" readonly><button onclick="step('cDataStar', 1)">+</button></div></div>
                </div>
                <div class="gear-row">
                    <div><label>ğŸ›¡ï¸ è£…ç”² Lv</label><div class="stepper"><button onclick="step('cArmorLv', -1)">-</button><input type="number" id="cArmorLv" value="40" min="0" max="40" onchange="calculate()"><button onclick="step('cArmorLv', 1)">+</button></div></div>
                    <div><label>â˜…</label><div class="stepper"><button onclick="step('cArmorStar', -1)">-</button><input type="text" id="cArmorStar" data-val="0" value="â˜†â˜†â˜†â˜†â˜†" readonly><button onclick="step('cArmorStar', 1)">+</button></div></div>
                </div>
                <div class="gear-row">
                    <div><label>ğŸ“¡ ãƒ¬ãƒ¼ãƒ€ãƒ¼ Lv</label><div class="stepper"><button onclick="step('cRadarLv', -1)">-</button><input type="number" id="cRadarLv" value="40" min="0" max="40" onchange="calculate()"><button onclick="step('cRadarLv', 1)">+</button></div></div>
                    <div><label>â˜…</label><div class="stepper"><button onclick="step('cRadarStar', -1)">-</button><input type="text" id="cRadarStar" data-val="0" value="â˜†â˜†â˜†â˜†â˜†" readonly><button onclick="step('cRadarStar', 1)">+</button></div></div>
                </div>
                <div class="result res-before">
                    <div style="font-size: 0.9rem; color: #7f8c8d; font-weight:bold;">è£…å‚™ãƒ»æ­¦è£…ã«ã‚ˆã‚‹ç·åˆãƒãƒ•</div>
                    <div class="score score-b">x <span id="scoreBefore">1.00</span></div>
                    <div id="detailBefore"></div>
                </div>
            </div>

            <div class="card card-after">
                <h3 class="panel-header" style="color:#c0392b;">ç›®æ¨™ã®è£…å‚™ <button class="reset-btn" onclick="resetGear()">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button></h3>
                <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px dashed #fadbd8;">
                    <label style="color:#c0392b;">âš”ï¸ æ­¦è£…Lv ç›®æ¨™ (0ã€œ30)</label>
                    <div class="stepper" style="border-color:#fadbd8;"><button onclick="step('tWeapon', -1)">-</button><input type="number" id="tWeapon" value="20" min="0" max="30" onchange="calculate()"><button onclick="step('tWeapon', 1)">+</button></div>
                </div>
                <div class="gear-row">
                    <div><label>ğŸ”« ãƒ¬ãƒ¼ãƒ«ã‚¬ãƒ³ Lv</label><div class="stepper"><button onclick="step('tGunLv', -1)">-</button><input type="number" id="tGunLv" value="40" min="0" max="40" onchange="calculate()"><button onclick="step('tGunLv', 1)">+</button></div></div>
                    <div><label>â˜…</label><div class="stepper"><button onclick="step('tGunStar', -1)">-</button><input type="text" id="tGunStar" data-val="2" value="â˜…â˜…â˜†â˜†â˜†" readonly><button onclick="step('tGunStar', 1)">+</button></div></div>
                </div>
                <div class="gear-row">
                    <div><label>ğŸ’¾ ãƒãƒƒãƒ— Lv</label><div class="stepper"><button onclick="step('tDataLv', -1)">-</button><input type="number" id="tDataLv" value="40" min="0" max="40" onchange="calculate()"><button onclick="step('tDataLv', 1)">+</button></div></div>
                    <div><label>â˜…</label><div class="stepper"><button onclick="step('tDataStar', -1)">-</button><input type="text" id="tDataStar" data-val="0" value="â˜†â˜†â˜†â˜†â˜†" readonly><button onclick="step('tDataStar', 1)">+</button></div></div>
                </div>
                <div class="gear-row">
                    <div><label>ğŸ›¡ï¸ è£…ç”² Lv</label><div class="stepper"><button onclick="step('tArmorLv', -1)">-</button><input type="number" id="tArmorLv" value="40" min="0" max="40" onchange="calculate()"><button onclick="step('tArmorLv', 1)">+</button></div></div>
                    <div><label>â˜…</label><div class="stepper"><button onclick="step('tArmorStar', -1)">-</button><input type="text" id="tArmorStar" data-val="0" value="â˜†â˜†â˜†â˜†â˜†" readonly><button onclick="step('tArmorStar', 1)">+</button></div></div>
                </div>
                <div class="gear-row">
                    <div><label>ğŸ“¡ ãƒ¬ãƒ¼ãƒ€ãƒ¼ Lv</label><div class="stepper"><button onclick="step('tRadarLv', -1)">-</button><input type="number" id="tRadarLv" value="40" min="0" max="40" onchange="calculate()"><button onclick="step('tRadarLv', 1)">+</button></div></div>
                    <div><label>â˜…</label><div class="stepper"><button onclick="step('tRadarStar', -1)">-</button><input type="text" id="tRadarStar" data-val="5" value="â˜…â˜…â˜…â˜…â˜…" readonly><button onclick="step('tRadarStar', 1)">+</button></div></div>
                </div>
                <div class="result res-after">
                    <div style="font-size: 0.9rem; color: #c0392b; font-weight:bold;">è£…å‚™ãƒ»æ­¦è£…ã«ã‚ˆã‚‹ç·åˆãƒãƒ•</div>
                    <div class="score score-a">x <span id="scoreAfter">1.00</span></div>
                    <div id="detailAfter"></div>
                </div>
            </div>
        </div>

        <div class="panel" id="costDetailPanel" style="display:none; margin-top: 20px; border-top: 4px solid #d35400;">
            <h3 class="panel-header" style="color:#d35400; border-bottom: none; padding-bottom: 0; margin-bottom:10px;">ğŸ†™ å¿…è¦ãªè£…å‚™ãƒ¬ã‚·ãƒ”</h3>
            <div id="costBreakdown" style="font-size: 0.95rem; line-height: 1.6; margin-bottom: 15px; padding-top: 10px; border-top: 1px dashed #ccc; font-weight:bold; color:#444;"></div>
            <div style="font-size: 0.85rem; color: #777; text-align: center; background: #fff4e6; padding: 12px; border-radius: 8px; border: 1px solid #fdebd0;">
                â˜…0â†’1:<b style="color:#f39c12; font-size:1rem;">5æš</b> / â˜…1â†’2:<b style="color:#f39c12; font-size:1rem;">10æš</b> / â˜…2â†’3:<b style="color:#f39c12; font-size:1rem;">15æš</b><br>
                â˜…3â†’4:<b style="color:#f39c12; font-size:1rem;">20æš</b> / â˜…4â†’5:<b style="color:#e74c3c; font-size:1rem;">èµ¤10æš</b>
            </div>
        </div>
    </div>
</div>

<div class="diff-wrapper" id="gearFooter" style="display:none;">
    <div class="diff">
        ä»Šã® ç´„ <span id="growthNum" style="font-size:1.6rem; margin:0 4px;">1.00</span> å€ï¼<br>
        <span id="footerCost" style="font-size: 0.95rem; font-weight: normal; display:none;">
            å¿…è¦ãƒ¬ã‚·ãƒ”: <span style="color:#f39c12; font-weight:bold;">UR <span id="footUr" style="font-size:1.2rem;">0</span>æš</span> / <span style="color:#e74c3c; font-weight:bold;">MR <span id="footMr" style="font-size:1.2rem;">0</span>æš</span>
        </span>
    </div>
</div>

<script>
// ==========================================
// å…±é€šãƒ»ã‚¿ãƒ–å‡¦ç†
// ==========================================
function switchTab(tabId) {
    document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
    
    document.getElementById(tabId).classList.add('active');
    event.currentTarget.classList.add('active');

    document.getElementById('gearFooter').style.display = (tabId === 'gearTab') ? 'block' : 'none';
}

// ==========================================
// éƒ¨éšŠç·¨æˆãƒ­ã‚¸ãƒƒã‚¯ (URæ˜‡æ ¼ã‚­ãƒ£ãƒ©å®Œå…¨å¯¾å¿œ)
// ==========================================
const HEROES = {
    empty: {n:"æœªè¨­å®š", t:"none", c:"hero-none", r:"none"},
    // æˆ¦è»Š
    murphy: {n:"ï¾ï½°ï¾Œï½¨", t:"tank", c:"hero-tank", r:"wall"},
    williams: {n:"ï½³ï½¨ï¾˜ï½±ï¾‘ï½½ï¾", t:"tank", c:"hero-tank", r:"wall"},
    scarlett: {n:"ï½½ï½¶ï½°ï¾šï½¯ï¾„", t:"tank", c:"hero-tank", r:"wall", isUR: true},
    violet: {n:"ï½³ï¾ï½¨ï½µï¾—", t:"tank", c:"hero-tank", r:"wall", isUR: true},
    kimberly: {n:"ï½·ï¾ï¾Šï¾ï¾˜ï½°", t:"tank", c:"hero-tank", r:"atk"},
    stetmann: {n:"ï½½ï¾ƒï½¯ï¾„ï¾ï¾ï¾", t:"tank", c:"hero-tank", r:"atk"},
    mason: {n:"ï¾’ï½²ï½¿ï¾", t:"tank", c:"hero-tank", r:"atk", isUR: true},
    marshall: {n:"ï¾ï½°ï½¼ï½¬ï¾™", t:"tank", c:"hero-tank", r:"sup"},
    // èˆªç©ºæ©Ÿ
    lucius: {n:"ï¾™ï½¼ï½³ï½½", t:"air", c:"hero-air", r:"wall"},
    carlie: {n:"ï½¶ï½°ï¾˜ï½°", t:"air", c:"hero-air", r:"wall"},
    dva: {n:"DVA", t:"air", c:"hero-air", r:"atk"},
    schuyler: {n:"ï½½ï½¶ï½²ï¾—ï½°", t:"air", c:"hero-air", r:"atk"},
    morrison: {n:"ï¾“ï¾˜ï½¿ï¾", t:"air", c:"hero-air", r:"atk"},
    sarah: {n:"ï½»ï¾—", t:"air", c:"hero-air", r:"atk", isUR: true},
    // ãƒŸã‚µã‚¤ãƒ«
    mcgregor: {n:"ï¾ï½¸ï¾šï½¶ï¾ï½°", t:"mis", c:"hero-mis", r:"wall"},
    adam: {n:"ï½±ï¾€ï¾ï¾‘", t:"mis", c:"hero-mis", r:"wall"},
    tesla: {n:"ï¾ƒï½½ï¾—", t:"mis", c:"hero-mis", r:"atk"},
    fiona: {n:"ï¾Œï½¨ï½µï¾…", t:"mis", c:"hero-mis", r:"atk"},
    swift: {n:"ï½½ï½³ï½¨ï¾Œï¾„", t:"mis", c:"hero-mis", r:"atk"},
    venom: {n:"ï¾ï¾ï¾‰ï¾‘", t:"mis", c:"hero-mis", r:"atk", isUR: true}
};

function getRoleIcon(r) {
    if(r === 'wall') return 'ğŸ›¡ï¸';
    if(r === 'atk') return 'âš”ï¸';
    if(r === 'sup') return 'ğŸ› ï¸';
    return '';
}

function getTypeInfo(t) {
    if(t === 'tank') return { text: 'æˆ¦è»Š', bg: 'bg-tank' };
    if(t === 'air') return { text: 'èˆªç©º', bg: 'bg-air' };
    if(t === 'mis') return { text: 'ï¾›ï½¹ï¾—ï¾', bg: 'bg-mis' };
    return { text: '', bg: '' };
}

function updateAllSelectOptions() {
    for(let s=1; s<=3; s++) {
        let selectedInSquad = [];
        for(let p=1; p<=5; p++){
            let el = document.getElementById(`h_${s}_${p}`);
            if(el && el.value !== 'empty') selectedInSquad.push(el.value);
        }
        
        for(let p=1; p<=5; p++){
            let selectEl = document.getElementById(`h_${s}_${p}`);
            if(!selectEl) continue;
            let currentVal = selectEl.value;
            for(let j=0; j<selectEl.options.length; j++){
                let opt = selectEl.options[j];
                if(opt.value !== 'empty' && selectedInSquad.includes(opt.value) && opt.value !== currentVal) {
                    opt.disabled = true;
                    opt.style.color = '#ccc';
                } else {
                    opt.disabled = false;
                    opt.style.color = '#333';
                }
            }
        }
    }
}

function initSquadUI() {
    let container = document.getElementById('squadContainer');
    let html = '';
    for(let s=1; s<=3; s++) {
        let isOpen = s===1 ? 'open' : '';
        let arrow = s===1 ? 'â–¼' : 'â–¶';
        html += `
            <div class="squad-section" id="sqSection${s}">
                <div class="squad-header" onclick="toggleSquad(${s})">
                    <span>ç¬¬${s}éƒ¨éšŠ</span><span id="sqArr${s}">${arrow}</span>
                </div>
                <div class="squad-body ${isOpen}" id="sqBody${s}">
                    ${[1,2].map(pos => makeHeroSlot(s, pos, "å‰è¡›")).join('')}
                    ${[3,4,5].map(pos => makeHeroSlot(s, pos, "å¾Œè¡›")).join('')}
                    <div id="sqVisual${s}" style="margin-top:20px;"></div>
                    <div id="sqAdvice${s}"></div>
                </div>
            </div>`;
    }
    container.innerHTML = html;
}

function makeHeroSlot(sq, pos, label) {
    let options = Object.keys(HEROES).map(k => {
        if(k === 'empty') return `<option value="${k}">- æœªè¨­å®š -</option>`;
        let typeText = getTypeInfo(HEROES[k].t).text;
        let roleIcon = getRoleIcon(HEROES[k].r);
        let urText = HEROES[k].isUR ? " (UR)" : "";
        return `<option value="${k}">[${typeText}] ${roleIcon} ${HEROES[k].n}${urText}</option>`;
    }).join('');
    
    return `
        <div class="hero-slot">
            <div style="font-size:0.85rem; color:#7f8c8d; font-weight:bold; width:35px;">${label}</div>
            <select class="hero-select" id="h_${sq}_${pos}" onchange="evalSquad(${sq}); saveSquadData();">${options}</select>
            <div class="wp-input-wrap">
                <span style="font-size:0.85rem; font-weight:bold; color:#555;">Lv</span>
                <div class="stepper" id="wp_wrap_${sq}_${pos}" style="width:80px; height:36px;">
                    <button style="width:28px; font-size:1.3rem;" onclick="stepSq('${sq}','${pos}',-1)">-</button>
                    <input type="number" id="wp_${sq}_${pos}" value="0" readonly>
                    <button style="width:28px; font-size:1.3rem;" onclick="stepSq('${sq}','${pos}',1)">+</button>
                </div>
            </div>
        </div>`;
}

function toggleSquad(s) {
    let body = document.getElementById(`sqBody${s}`);
    let arr = document.getElementById(`sqArr${s}`);
    if(body.classList.contains('open')){
        body.classList.remove('open'); arr.innerText = 'â–¶';
    }else{
        body.classList.add('open'); arr.innerText = 'â–¼';
    }
}

function stepSq(sq, pos, delta) {
    let el = document.getElementById(`wp_${sq}_${pos}`);
    let v = parseInt(el.value)||0;
    el.value = Math.min(Math.max(v + delta, 0), 30);
    evalSquad(sq);
    saveSquadData();
}

function renderHeroBox(h) {
    if(h.id === 'empty') return `<div class="hero-box ${h.c}"><div class="hero-name" style="margin-top:10px;">- æœªè¨­å®š -</div></div>`;
    
    let typeInfo = getTypeInfo(h.t);
    let typeBadge = `<div class="type-badge ${typeInfo.bg}">${typeInfo.text}</div>`;
    let roleIcon = getRoleIcon(h.r);
    let urTag = h.isUR ? `<span style="color:#8e44ad; font-size:0.65rem;">(UR)</span>` : '';
    let wpText = h.isUR ? `<span style="opacity:0.5;">æ­¦è£…æœªå®Ÿè£…</span>` : `æ­¦è£…Lv${h.wp}`;
    
    return `
        <div class="hero-box ${h.c}">
            ${typeBadge}
            <div class="hero-name">${roleIcon} ${h.n}${urTag}</div>
            <span style="font-size:0.8rem;font-weight:bold;color:inherit;">${wpText}</span>
        </div>`;
}

function evalSquad(sq) {
    updateAllSelectOptions(); 

    let heroes = [];
    let counts = {tank:0, air:0, mis:0, none:0};
    
    for(let i=1; i<=5; i++){
        let hid = document.getElementById(`h_${sq}_${i}`).value;
        let wpEl = document.getElementById(`wp_${sq}_${i}`);
        let wpWrap = document.getElementById(`wp_wrap_${sq}_${i}`);
        let hdata = HEROES[hid];
        
        // â–¼ URæ˜‡æ ¼çµ„ ã¾ãŸã¯ æœªè¨­å®š ã®å ´åˆã¯å°‚ç”¨æ­¦è£…å…¥åŠ›ã‚’ãƒ­ãƒƒã‚¯(ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ)ã—ã¦0ã«ã™ã‚‹ â–¼
        if (hdata.isUR || hid === 'empty') {
            wpWrap.classList.add('disabled');
            wpEl.value = 0;
        } else {
            wpWrap.classList.remove('disabled');
        }

        let wp = parseInt(wpEl.value)||0;
        heroes.push({pos: i, id: hid, wp: wp, ...hdata});
        counts[hdata.t]++;
    }

    let visHtml = `
        <div class="form-visual-row">${[heroes[0], heroes[1]].map(renderHeroBox).join('')}</div>
        <div class="form-visual-row">${[heroes[2], heroes[3], heroes[4]].map(renderHeroBox).join('')}</div>
    `;
    document.getElementById(`sqVisual${sq}`).innerHTML = visHtml;

    let adviceHtml = "";
    let isComplete = counts.none === 0;
    
    if(!isComplete) {
        adviceHtml = `<div class="advice-box">5äººã™ã¹ã¦é…ç½®ã—ã¦ãã ã•ã„ã€‚</div>`;
    } else {
        let maxCount = Math.max(counts.tank, counts.air, counts.mis);
        let buffText = maxCount === 5 ? "åŒå…µç¨®5ä½“ (ãƒãƒ•+20%)" : maxCount === 4 ? "åŒå…µç¨®4ä½“ (ãƒãƒ•+15%)" : maxCount === 3 ? "åŒå…µç¨®3ä½“ / 3+2 (ãƒãƒ•+10%)" : "ãƒãƒ•ãªã—";
        let mainType = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);
        
        let msgs = [`<b style="color:#2980b9; font-size:1.05rem;">ã€ç·¨æˆãƒœãƒ¼ãƒŠã‚¹ã€‘${buffText}</b>`];
        let hasError = false;
        let isPerfect = false;

        // å‰è¡›é…ç½®ãƒã‚§ãƒƒã‚¯
        if(heroes[0].r === 'atk' || heroes[0].r === 'sup' || heroes[1].r === 'atk' || heroes[1].r === 'sup') {
            msgs.push("âš ï¸ å‰è¡›ã«ç«åŠ›/æ”¯æ´ãŒã„ã¾ã™ã€‚ç›¾å½¹(ğŸ›¡ï¸)ã‚’é…ç½®ã—ã¦ãã ã•ã„ã€‚");
            hasError = true;
        }

        // URæ˜‡æ ¼ã‚­ãƒ£ãƒ©ã®æ³¨è¨˜
        let hasURPromo = heroes.some(h => h.isUR);
        if (hasURPromo) {
            msgs.push("<span style='color:#8e44ad; font-size:0.85rem;'>ğŸ’¡ ã€è£œè¶³ã€‘ãƒ´ã‚£ã‚ªãƒ©ã‚„ã‚¹ã‚«ãƒ¼ãƒ¬ãƒƒãƒˆç­‰ã®å…ƒSSRçµ„ã¯ã€ŒURæ˜‡æ ¼æ¸ˆã¿ã€ã‚’å‰æã¨ã—ãŸåˆ¤å®šã§ã™ã€‚</span>");
        }

        if (maxCount === 4) {
            let outider = heroes.find(h => h.t !== mainType);
            if(outider.id === 'lucius') {
                if(outider.wp < 10) { msgs.push("âš ï¸ ãƒ«ã‚·ã‚¦ã‚¹ã®å‡ºå¼µã¯å›é¿è§£æ”¾ã®ã€å°‚æ­¦Lv10ã€‘æœªæº€ã¯éæ¨å¥¨ã§ã™ã€‚"); hasError = true; }
                else { msgs.push("â­• ãƒ«ã‚·ã‚¦ã‚¹å‡ºå¼µOKï¼å›é¿ã«ã‚ˆã‚‹è€ä¹…ãŒãƒãƒ•æ¸›å°‘åˆ†ã‚’è£œã„ã¾ã™ã€‚"); isPerfect = true;}
            } else if(outider.id === 'murphy') {
                if(outider.wp < 20) { msgs.push("âš ï¸ ãƒãƒ¼ãƒ•ã‚£ãƒ¼å‡ºå¼µã¯åŸºç¤ã‚¹ãƒ†ãŒä¸ŠãŒã‚‹ã€å°‚æ­¦Lv20ã€‘æœªæº€ã¯éæ¨å¥¨ã§ã™ã€‚"); hasError = true; }
                else { msgs.push("â­• ãƒãƒ¼ãƒ•ã‚£ãƒ¼å‡ºå¼µOKï¼å¯¾ãƒ­ã‚±ãƒ©ãƒ³ã®ç‰©ç†ç›¾ã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚"); isPerfect = true;}
            } else if(outider.id === 'scarlett') {
                msgs.push(`â­• ï½½ï½¶ï½°ï¾šï½¯ï¾„å‡ºå¼µOKï¼URåŒ–ã«ã‚ˆã‚‹åœ§å€’çš„ãªHPã§ã€ã©ã®å…µç¨®ã§ã‚‚æœ€å¼·ã‚¯ãƒ©ã‚¹ã®è‚‰ç›¾ã«ãªã‚Šã¾ã™ã€‚`); 
                isPerfect = true;
            } else if(outider.id === 'violet') {
                msgs.push(`â­• ï½³ï¾ï½¨ï½µï¾—å‡ºå¼µOKï¼URåŒ–ã«ã‚ˆã‚‹ãƒ€ãƒ¡ãƒ¼ã‚¸è»½æ¸›ãŒå„ªç§€ã§ã€å‰è¡›ã®ä»£ç”¨ã¨ã—ã¦ååˆ†ã«æ©Ÿèƒ½ã—ã¾ã™ã€‚`); 
                isPerfect = true;
            } else if(outider.isUR && outider.r === 'atk') {
                msgs.push(`âš ï¸ ${outider.n}ã®å‡ºå¼µã¯éæ¨å¥¨ã§ã™ã€‚ç´”æ­£URã®å°‚æ­¦Lv30ã»ã©ã®ç†ä¸å°½ç«åŠ›ãŒãªã„ãŸã‚ã€ãƒãƒ•ã‚’è½ã¨ã™ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚`); 
                hasError = true;
            } else if(outider.r === 'atk') {
                if(outider.wp < 30) { msgs.push(`âš ï¸ ${outider.n}ã®å‡ºå¼µã¯ã€å°‚æ­¦Lv30ã€‘å¿…é ˆã§ã™ã€‚ç«åŠ›ãŒè¶³ã‚Šãšãƒãƒ•æ¸›å°‘ã®èµ¤å­—ã«ãªã‚Šã¾ã™ã€‚`); hasError = true; }
                else { msgs.push(`ğŸ”¥ ${outider.n}å‡ºå¼µOKï¼Lv30ã®ç†ä¸å°½ãªç«åŠ›ã§æ•µã‚’ç²‰ç •ã§ãã¾ã™ã€‚`); isPerfect = true;}
            } else if(outider.r === 'wall') {
                msgs.push(`âš ï¸ ${outider.n}ã‚’ã‚ãˆã¦å‡ºå¼µã•ã›ã‚‹ãƒ¡ãƒªãƒƒãƒˆã¯è–„ã„ã§ã™ã€‚(ï¾ï½°ï¾Œï½¨ï½°, ï¾™ï½¼ï½³ï½½, URï½½ï½¶ï½°ï¾šï½¯ï¾„ç­‰ã‚’æ¨å¥¨)`); hasError = true;
            } else {
                msgs.push(`âš ï¸ ${outider.n}ã®å‡ºå¼µã¯éæ¨å¥¨ã§ã™ã€‚`); hasError = true;
            }
        } else if (maxCount === 5) {
            msgs.push("â­• æœ€ã‚‚å®‰å®šã—ã¦ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒä¼¸ã³ã‚‹ç‹é“ã®å½¢ã§ã™ã€‚");
            isPerfect = true;
        } else if (maxCount === 3) {
            let types = Object.values(counts).filter(c => c > 0);
            if (types.includes(3) && types.includes(2)) {
                msgs.push("âš ï¸ ã€3+2ç·¨æˆã€‘ãƒˆãƒƒãƒ—å±¤ã®å°‚æ­¦Lv30ã«ã‚ˆã‚‹æš´åŠ›ä»¥å¤–ã§ã¯ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ä¸è¶³ã«ãªã‚ŠãŒã¡ã§éæ¨å¥¨ã§ã™ã€‚");
                hasError = true;
            } else {
                msgs.push("âŒ ãƒãƒ•ãŒä½ã™ãã¾ã™ã€‚æœ€ä½ã§ã‚‚4ä½“ã¯åŒã˜å…µç¨®ã§æƒãˆã¾ã—ã‚‡ã†ã€‚");
                hasError = true;
            }
        } else {
            msgs.push("âŒ ãƒãƒ•ãŒä½ã™ãã¾ã™ã€‚æœ€ä½ã§ã‚‚4ä½“ã¯åŒã˜å…µç¨®ã§æƒãˆã¾ã—ã‚‡ã†ã€‚");
            hasError = true;
        }

        let boxClass = hasError ? "advice-err" : (isPerfect ? "advice-ok" : "");
        adviceHtml = `<div class="advice-box ${boxClass}">${msgs.join('<br>')}</div>`;
    }
    document.getElementById(`sqAdvice${sq}`).innerHTML = adviceHtml;
}

function saveSquadData() {
    let sqData = {};
    for(let s=1; s<=3; s++){
        for(let p=1; p<=5; p++){
            let hEl = document.getElementById(`h_${s}_${p}`);
            let wEl = document.getElementById(`wp_${s}_${p}`);
            if(hEl && wEl) {
                sqData[`h_${s}_${p}`] = hEl.value;
                sqData[`wp_${s}_${p}`] = wEl.value;
            }
        }
    }
    localStorage.setItem('lastwar_squad_data_v8', JSON.stringify(sqData));
}

function loadSquadData() {
    let saved = localStorage.getItem('lastwar_squad_data_v8') || localStorage.getItem('lastwar_squad_data_v7');
    if(saved) {
        let data = JSON.parse(saved);
        for(let k in data) {
            let el = document.getElementById(k);
            if(el) el.value = data[k];
        }
    } else {
        const t1 = ['murphy', 'williams', 'kimberly', 'marshall', 'stetmann'];
        for(let i=1; i<=5; i++) {
            document.getElementById(`h_1_${i}`).value = t1[i-1];
            document.getElementById(`wp_1_${i}`).value = i===3 ? 20 : 10;
        }
    }
    for(let s=1; s<=3; s++) evalSquad(s);
}

function resetSquads() {
    if(confirm("éƒ¨éšŠç·¨æˆã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")){
        localStorage.removeItem('lastwar_squad_data_v8');
        location.reload();
    }
}

// ==========================================
// è£…å‚™ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ãƒ­ã‚¸ãƒƒã‚¯
// ==========================================
function saveGearData() {
    const data = {};
    document.querySelectorAll('#gearTab input').forEach(input => {
        data[input.id] = input.id.includes('Star') ? input.getAttribute('data-val') : input.value;
    });
    localStorage.setItem('lastwar_gear_data', JSON.stringify(data));
}

function loadGearData() {
    const saved = localStorage.getItem('lastwar_gear_data');
    if (!saved) return false;
    const data = JSON.parse(saved);
    for (let id in data) {
        let el = document.getElementById(id);
        if (el) {
            if (id.includes('Star')) { el.setAttribute('data-val', data[id]); updateStarDisplay(el, parseInt(data[id])); }
            else { el.value = data[id]; }
        }
    }
    const keys = ['Weapon', 'GunLv', 'GunStar', 'DataLv', 'DataStar', 'ArmorLv', 'ArmorStar', 'RadarLv', 'RadarStar'];
    keys.forEach(k => {
        let cEl = document.getElementById('c'+k), tEl = document.getElementById('t'+k);
        if(cEl && tEl) {
            let cVal = k.includes('Star') ? parseInt(cEl.getAttribute('data-val')) : parseInt(cEl.value);
            let tVal = k.includes('Star') ? parseInt(tEl.getAttribute('data-val')) : parseInt(tEl.value);
            if (cVal > tVal) {
                if(k.includes('Star')) { tEl.setAttribute('data-val', cVal); updateStarDisplay(tEl, cVal); }
                else { tEl.value = cVal; }
            }
        }
    });
    return true;
}

function resetGear() {
    if(confirm("è£…å‚™ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–ã—ã¾ã™ã‹ï¼Ÿ")) { localStorage.removeItem('lastwar_gear_data'); location.reload(); }
}

function animateValue(obj, start, end, duration, isRatio = false) {
    if(!obj) return;
    let startTimestamp = null;
    const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        const easeOut = 1 - Math.pow(1 - progress, 3);
        let current = start + (end - start) * easeOut;
        obj.innerHTML = isRatio ? current.toFixed(2) : Math.floor(current).toLocaleString();
        if (progress < 1) window.requestAnimationFrame(step);
        else obj.innerHTML = isRatio ? end.toFixed(2) : Math.floor(end).toLocaleString();
    };
    window.requestAnimationFrame(step);
}

function updateStarDisplay(el, val) {
    let stars = ""; for (let i = 0; i < 5; i++) stars += (i < val) ? "â˜…" : "â˜†";
    el.value = stars;
    if (val === 5) el.style.color = "#e74c3c";
    else if (val > 0) el.style.color = "#f39c12";
    else el.style.color = "#bdc3c7";
}

function step(id, delta) {
    let el = document.getElementById(id);
    let isStar = id.includes('Star');
    let val = parseInt(isStar ? el.getAttribute('data-val') : el.value) || 0;
    
    let min = isStar ? 0 : (parseInt(el.getAttribute('min')) || 0);
    let max = isStar ? 5 : (parseInt(el.getAttribute('max')) || 999);
    
    let oldVal = val; 
    let newVal = Math.min(Math.max(val + delta, min), max);
    
    if (isStar) { el.setAttribute('data-val', newVal); updateStarDisplay(el, newVal); }
    else { el.value = newVal; }
    
    if (id.startsWith('c')) {
        let tId = 't' + id.substring(1);
        let tEl = document.getElementById(tId);
        let tVal = isStar ? parseInt(tEl.getAttribute('data-val')) : parseInt(tEl.value);
        if (newVal > tVal) {
            if (isStar) { tEl.setAttribute('data-val', newVal); updateStarDisplay(tEl, newVal); }
            else { tEl.value = newVal; }
        } else if (newVal < oldVal && tVal === oldVal) {
            if (isStar) { tEl.setAttribute('data-val', newVal); updateStarDisplay(tEl, newVal); }
            else { tEl.value = newVal; }
        }
    }
    calculate();
}

function getGearMultiplier(gearLevel, stars, type) {
    let baseBoost = 0.025 + (gearLevel * 0.00125);
    let starBoost = [0, 0.025, 0.075, 0.1, 0.15, 0.23][stars] || 0;
    let passiveMulti = 1.0;
    if (stars === 5) {
        if (type === 'gun') passiveMulti = 1.10;
        if (type === 'radar') passiveMulti = 1.30;
        if (type === 'armor') passiveMulti = 1.15;
        if (type === 'data') passiveMulti = 1.05;
    }
    return { statMulti: 1.0 + baseBoost + starBoost, passiveMulti: passiveMulti };
}

let lastB_multi = 1.00, lastA_multi = 1.00, lastRatio = 1.00;

function calculate() {
    const gears = ['Gun', 'Data', 'Armor', 'Radar'];
    const gearNames = { 'Gun': 'ğŸ”«ãƒ¬ãƒ¼ãƒ«ã‚¬ãƒ³', 'Data': 'ğŸ’¾ãƒãƒƒãƒ—', 'Armor': 'ğŸ›¡ï¸è£…ç”²', 'Radar': 'ğŸ“¡ãƒ¬ãƒ¼ãƒ€ãƒ¼' };
    
    const urCumulative = [0, 5, 15, 30, 50, 50]; 
    const mrCumulative = [0, 0, 0, 0, 0, 10];
    let totalUrReq = 0, totalMrReq = 0;
    let breakdownHtml = "";

    ['c', 't'].forEach(p => {
        gears.forEach(g => {
            let lvEl = document.getElementById(p+g+'Lv');
            let sEl = document.getElementById(p+g+'Star');
            if (parseInt(lvEl.value) < 40) { sEl.setAttribute('data-val', 0); updateStarDisplay(sEl, 0); sEl.closest('.stepper').style.opacity = "0.5"; }
            else sEl.closest('.stepper').style.opacity = "1";
        });
    });
    
    gears.forEach(g => {
        let cLv = parseInt(document.getElementById('c'+g+'Lv').value);
        let cStar = cLv >= 40 ? parseInt(document.getElementById('c'+g+'Star').getAttribute('data-val')) : 0;
        let tLv = parseInt(document.getElementById('t'+g+'Lv').value);
        let tStar = tLv >= 40 ? parseInt(document.getElementById('t'+g+'Star').getAttribute('data-val')) : 0;
        
        if (tStar > cStar) {
            let urReq = urCumulative[tStar] - urCumulative[cStar];
            let mrReq = mrCumulative[tStar] - mrCumulative[cStar];
            totalUrReq += urReq;
            totalMrReq += mrReq;
            let reqText = [];
            if (urReq > 0) reqText.push(`<span style="color:#f39c12;">UR ${urReq}æš</span>`);
            if (mrReq > 0) reqText.push(`<span style="color:#e74c3c;">MR ${mrReq}æš</span>`);
            breakdownHtml += `<div style="margin-bottom: 8px; border-bottom: 1px dashed #eee; padding-bottom: 6px;">${gearNames[g]} : â˜…${cStar} â†’ â˜…${tStar} <span style="float:right;">${reqText.join(' ï¼‹ ')}</span></div>`;
        }
    });
    
    let detailPanel = document.getElementById("costDetailPanel");
    let footerCost = document.getElementById("footerCost");
    
    if (totalUrReq > 0 || totalMrReq > 0) {
        document.getElementById("footUr").innerText = totalUrReq;
        document.getElementById("footMr").innerText = totalMrReq;
        footerCost.style.display = "inline";
        document.getElementById("costBreakdown").innerHTML = breakdownHtml;
        detailPanel.style.display = "block";
    } else {
        footerCost.style.display = "none";
        detailPanel.style.display = "none";
    }

    const calc = (p) => {
        let wp = parseInt(document.getElementById(p+'Weapon').value);
        let m = gears.map(g => getGearMultiplier(parseInt(document.getElementById(p+g+'Lv').value), parseInt(document.getElementById(p+g+'Star').getAttribute('data-val')), g.toLowerCase()));
        
        let gearStat = m[0].statMulti * m[1].statMulti * ((m[2].statMulti + m[3].statMulti)/2);
        let gearPass = m.reduce((acc, cur) => acc * cur.passiveMulti, 1);
        let wpMulti = (1.0 + (wp * 0.01)) * ([1, 1.05, 1.2, 1.4][Math.floor(wp/10)] || 1);
        let totalM = gearStat * gearPass * wpMulti;
        
        let activeMythics = [];
        if (m[0].passiveMulti > 1) activeMythics.push("ãƒ¬ãƒ¼ãƒ«ã‚¬ãƒ³ (ç›¸æ€§æœ‰åˆ©æ™‚ä¸ãƒ€ãƒ¡+10%)");
        if (m[1].passiveMulti > 1) activeMythics.push("ãƒãƒƒãƒ— (ç›¸æ€§æœ‰åˆ©æ™‚è¢«ãƒ€ãƒ¡5%æ¸›)");
        if (m[2].passiveMulti > 1) activeMythics.push("è£…ç”² (ä¼šå¿ƒè¢«å¼¾ç‡15%æ¸›)");
        if (m[3].passiveMulti > 1) activeMythics.push("ãƒ¬ãƒ¼ãƒ€ãƒ¼ (è¢«ä¼šå¿ƒãƒ€ãƒ¡30%æ¸›)");
        let mythicText = activeMythics.length > 0 ? "<div class='mythic-box'><span style='color:#e74c3c; font-weight:bold;'>â˜…5 èµ¤ãƒ‘ãƒƒã‚·ãƒ–ç™ºå‹•ï¼š</span><br>ãƒ»" + activeMythics.join("<br>ãƒ»") + "</div>" : "";
        
        return { multi: totalM, mythicText: mythicText };
    };
    
    let resB = calc('c'), resA = calc('t');
    
    animateValue(document.getElementById("scoreBefore"), lastB_multi, resB.multi, 400, true);
    animateValue(document.getElementById("scoreAfter"), lastA_multi, resA.multi, 400, true);
    
    document.getElementById("detailBefore").innerHTML = resB.mythicText;
    document.getElementById("detailAfter").innerHTML = resA.mythicText;
    
    let currentRatio = (resB.multi > 0) ? (resA.multi / resB.multi) : 1.00;
    animateValue(document.getElementById("growthNum"), lastRatio, currentRatio, 400, true);
    
    lastB_multi = resB.multi; lastA_multi = resA.multi; lastRatio = currentRatio;
    saveGearData();
}

window.onload = () => {
    initSquadUI();
    loadSquadData();
    loadGearData();
    calculate();
    document.getElementById('gearFooter').style.display = 'none';
};
</script>
</body>
</html>
