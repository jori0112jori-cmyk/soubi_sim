<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ãƒ©ã‚¹ãƒˆã‚¦ã‚©ãƒ¼è£…å‚™ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
<style>
    /* æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¶­æŒã—ã¤ã¤ã€ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ç­‰ã‚’è¿½åŠ  */
    body { font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif; background-color: #f0f4f8; color: #333; padding: 15px; padding-bottom: 100px; margin: 0; }
    h1 { font-size: 1.3rem; text-align: center; color: #2c3e50; margin-bottom: 20px; line-height: 1.4; }
    .container { max-width: 1000px; margin: 0 auto; position: relative; }
    .panel { background: #fff; padding: 15px; border-radius: 12px; box-shadow: 0 6px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
    .grid { display: flex; gap: 20px; flex-wrap: wrap; }
    .card { flex: 1; min-width: 100%; background: #fff; padding: 20px 15px; border-radius: 12px; box-shadow: 0 6px 15px rgba(0,0,0,0.05); box-sizing: border-box;}
    @media (min-width: 768px) { .card { min-width: calc(50% - 10px); } }
    .card-before { border-top: 6px solid #7f8c8d; }
    .card-after { border-top: 6px solid #e74c3c; background: linear-gradient(to bottom, #fffafb, #ffffff); }
    .panel-header { display: flex; justify-content: space-between; align-items: center; margin-top: 0; color: #2980b9; border-bottom: 2px solid #ecf0f1; padding-bottom: 10px; font-size: 1.1rem; }
    label { display: block; margin-top: 15px; margin-bottom: 5px; font-weight: bold; font-size: 0.85rem; color: #444; }
    .stepper { display: flex; align-items: center; background: #fff; border: 1px solid #ccd1d9; border-radius: 8px; overflow: hidden; height: 44px; transition: 0.2s; box-shadow: inset 0 1px 3px rgba(0,0,0,0.02); }
    .stepper button { width: 38px; height: 100%; border: none; background: #eef2f5; font-size: 1.4rem; font-weight: bold; color: #34495e; cursor: pointer; touch-action: manipulation; display: flex; justify-content: center; align-items: center; }
    .stepper button:active { background: #dcdde1; }
    .stepper input { flex: 1; text-align: center; border: none; font-size: 18px; font-weight: bold; color: #2c3e50; padding: 0; min-width: 0; height: 100%; -webkit-appearance: none; margin: 0; background: transparent; }
    .stepper input[readonly] { font-size: 14px; letter-spacing: -1px; }
    .stepper.disabled { opacity: 0.5; pointer-events: none; background-color: #ecf0f1; }
    .gear-row { display: grid; grid-template-columns: 1.3fr 1fr; gap: 10px; margin-bottom: 5px; }
    .gear-row label { margin-top: 10px; font-size: 0.8rem; }
    .result { margin-top: 25px; padding: 15px; border-radius: 10px; text-align: center; border: 1px solid #eee; background-color: #f8f9fa;}
    .res-after { background-color: #faeaeb; border-color: #fadbd8; }
    .score { font-size: 2.2rem; font-weight: bold; margin: 10px 0; font-family: "Arial Black", Arial, sans-serif; }
    .score-b { color: #7f8c8d; }
    .score-a { color: #c0392b; }
    .detail-text { font-size: 0.85rem; color: #444; line-height: 1.6; text-align: left; padding: 12px; background: #fff; border-radius: 8px; margin-top: 15px; border-left: 4px solid #3498db; }
    .res-after .detail-text { border-left-color: #e74c3c; } 
    .diff-wrapper { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); width: calc(100% - 30px); max-width: 970px; z-index: 1000; }
    .diff { font-size: 1.3rem; color: #e74c3c; font-weight: bold; text-align: center; padding: 16px; background: rgba(255, 242, 242, 0.95); backdrop-filter: blur(5px); border-radius: 12px; border: 2px solid #fadbd8; box-shadow: 0 10px 20px rgba(231, 76, 60, 0.15); transition: 0.3s; }
    .reset-btn { font-size: 0.7rem; background: #ecf0f1; color: #7f8c8d; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; }
    .reset-btn:active { background: #dcdde1; }
</style>
</head>
<body>
<div class="container">
    <h1>è£…å‚™ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼<br><span style="font-size: 0.9rem; color: #7f8c8d;">(è‡ªå‹•ä¿å­˜æ©Ÿèƒ½ä»˜ã)</span></h1>
    <div class="panel">
        <h3 class="panel-header">ğŸ¢ å…±é€šè¨­å®š <button class="reset-btn" onclick="resetAllData()">ãƒ‡ãƒ¼ã‚¿ã‚’å…¨ã‚¯ãƒªã‚¢</button></h3>
        <label>æœ¬éƒ¨ãƒ¬ãƒ™ãƒ« (MAX 35)</label>
        <div class="stepper" style="max-width: 200px;">
            <button type="button" onclick="stepHQ(-1)">-</button>
            <input type="number" id="hqLevel" value="30" min="1" max="35" onchange="updateHQ()">
            <button type="button" onclick="stepHQ(1)">+</button>
        </div>
    </div>
    <div class="grid">
        <div class="card card-before">
            <h3 class="panel-header">1. ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h3>
            <div class="gear-row" style="grid-template-columns: 1..6fr 1fr;">
                <div><label id="cLevelLabel">ğŸ‘¤ Lv</label><div class="stepper"><button onclick="step('cLevel', -1)">-</button><input type="number" id="cLevel" value="150" min="1" onchange="calculate()"><button onclick="step('cLevel', 1)">+</button></div></div>
                <div><label>âš”ï¸ æ­¦è£…Lv (0~30)</label><div class="stepper"><button onclick="step('cWeapon', -1)">-</button><input type="number" id="cWeapon" value="20" min="0" max="30" onchange="calculate()"><button onclick="step('cWeapon', 1)">+</button></div></div>
            </div>
            <div style="margin-top:20px; padding-top:15px; border-top:1px dashed #ccc;">
                <div class="gear-row">
                    <div><label>ğŸ”« ç ²å¡” Lv</label><div class="stepper"><button onclick="step('cGunLv', -1)">-</button><input type="number" id="cGunLv" value="40" min="0" max="40" onchange="calculate()"><button onclick="step('cGunLv', 1)">+</button></div></div>
                    <div><label>â˜…</label><div class="stepper"><button onclick="step('cGunStar', -1)">-</button><input type="text" id="cGunStar" data-val="0" value="â˜†â˜†â˜†â˜†â˜†" readonly><button onclick="step('cGunStar', 1)">+</button></div></div>
                </div>
                <div class="gear-row">
                    <div><label>ğŸ’¾ ãƒãƒƒãƒ— Lv</label><div class="stepper"><button onclick="step('cDataLv', -1)">-</button><input type="number" id="cDataLv" value="40" min="0" max="40" onchange="calculate()"><button onclick="step('cDataLv', 1)">+</button></div></div>
                    <div><label>â˜…</label><div class="stepper"><button onclick="step('cDataStar', -1)">-</button><input type="text" id="cDataStar" data-val="0" value="â˜†â˜†â˜†â˜†â˜†" readonly><button onclick="step('cDataStar', 1)">+</button></div></div>
                </div>
                <div class="gear-row">
                    <div><label>ğŸ›¡ï¸ è£…ç”² Lv</label><div class="stepper"><button onclick="step('cArmorLv', -1)">-</button><input type="number" id="cArmorLv" value="20" min="0" max="40" onchange="calculate()"><button onclick="step('cArmorLv', 1)">+</button></div></div>
                    <div><label>â˜…</label><div class="stepper"><button onclick="step('cArmorStar', -1)">-</button><input type="text" id="cArmorStar" data-val="0" value="â˜†â˜†â˜†â˜†â˜†" readonly><button onclick="step('cArmorStar', 1)">+</button></div></div>
                </div>
                <div class="gear-row">
                    <div><label>ğŸ“¡ ãƒ¬ãƒ¼ãƒ€ãƒ¼ Lv</label><div class="stepper"><button onclick="step('cRadarLv', -1)">-</button><input type="number" id="cRadarLv" value="20" min="0" max="40" onchange="calculate()"><button onclick="step('cRadarLv', 1)">+</button></div></div>
                    <div><label>â˜…</label><div class="stepper"><button onclick="step('cRadarStar', -1)">-</button><input type="text" id="cRadarStar" data-val="0" value="â˜†â˜†â˜†â˜†â˜†" readonly><button onclick="step('cRadarStar', 1)">+</button></div></div>
                </div>
            </div>
            <div class="result res-before"><div>ç¾åœ¨ã®æˆ¦é—˜åŠ›ã‚¹ã‚³ã‚¢</div><div class="score score-b" id="scoreBefore">0</div><div class="detail-text" id="detailBefore"></div></div>
        </div>
        <div class="card card-after">
            <h3 class="panel-header">2. ç›®æ¨™ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h3>
            <div class="gear-row" style="grid-template-columns: 1.6fr 1fr;">
                <div><label id="tLevelLabel">ğŸ‘¤ Lv</label><div class="stepper"><button onclick="step('tLevel', -1)">-</button><input type="number" id="tLevel" value="150" min="1" onchange="calculate()"><button onclick="step('tLevel', 1)">+</button></div></div>
                <div><label>âš”ï¸ æ­¦è£…Lv (0~30)</label><div class="stepper"><button onclick="step('tWeapon', -1)">-</button><input type="number" id="tWeapon" value="20" min="0" max="30" onchange="calculate()"><button onclick="step('tWeapon', 1)">+</button></div></div>
            </div>
            <div style="margin-top:20px; padding-top:15px; border-top:1px dashed #ccc;">
                <div class="gear-row">
                    <div><label>ğŸ”« ç ²å¡” Lv</label><div class="stepper"><button onclick="step('tGunLv', -1)">-</button><input type="number" id="tGunLv" value="40" min="0" max="40" onchange="calculate()"><button onclick="step('tGunLv', 1)">+</button></div></div>
                    <div><label>â˜…</label><div class="stepper"><button onclick="step('tGunStar', -1)">-</button><input type="text" id="tGunStar" data-val="2" value="â˜…â˜…â˜†â˜†â˜†" readonly><button onclick="step('tGunStar', 1)">+</button></div></div>
                </div>
                <div class="gear-row">
                    <div><label>ğŸ’¾ ãƒãƒƒãƒ— Lv</label><div class="stepper"><button onclick="step('tDataLv', -1)">-</button><input type="number" id="tDataLv" value="40" min="0" max="40" onchange="calculate()"><button onclick="step('tDataLv', 1)">+</button></div></div>
                    <div><label>â˜…</label><div class="stepper"><button onclick="step('tDataStar', -1)">-</button><input type="text" id="tDataStar" data-val="0" value="â˜†â˜†â˜†â˜†â˜†" readonly><button onclick="step('tDataStar', 1)">+</button></div></div>
                </div>
                <div class="gear-row">
                    <div><label>ğŸ›¡ï¸ è£…ç”² Lv</label><div class="stepper"><button onclick="step('tArmorLv', -1)">-</button><input type="number" id="tArmorLv" value="40" min="0" max="40" onchange="calculate()"><button onclick="step('tArmorLv', 1)">+</button></div></div>
                    <div><label>â˜…</label><div class="stepper"><button onclick="step('tArmorStar', -1)">-</button><input type="text" id="tArmorStar" data-val="0" value="â˜†â˜†â˜†â˜†â˜†" readonly><button onclick="step('tArmorStar', 1)">+</button></div></div>
                </div>
                <div class="gear-row">
                    <div><label>ğŸ“¡ ãƒ¬ãƒ¼ãƒ€ãƒ¼ Lv</label><div class="stepper"><button onclick="step('tRadarLv', -1)">-</button><input type="number" id="tRadarLv" value="40" min="0" max="40" onchange="calculate()"><button onclick="step('tRadarLv', 1)">+</button></div></div>
                    <div><label>â˜…</label><div class="stepper"><button onclick="step('tRadarStar', -1)">-</button><input type="text" id="tRadarStar" data-val="5" value="â˜…â˜…â˜…â˜…â˜…" readonly><button onclick="step('tRadarStar', 1)">+</button></div></div>
                </div>
            </div>
            <div class="result res-after"><div>å¼·åŒ–å¾Œã®æˆ¦é—˜åŠ›ã‚¹ã‚³ã‚¢</div><div class="score score-a" id="scoreAfter">0</div><div class="detail-text" id="detailAfter"></div></div>
        </div>
    </div>
</div>
<div class="diff-wrapper"><div class="diff" id="growthDiff">æˆ¦é—˜åŠ›ãŒ ç´„ <span id="growthNum">0</span>% ã‚¢ãƒƒãƒ—ï¼</div></div>
<script>
// --- ä¿å­˜ãƒ»å¾©å…ƒãƒ­ã‚¸ãƒƒã‚¯ ---
function saveAllData() {
    const data = {};
    const inputs = document.querySelectorAll('input');
    inputs.forEach(input => {
        if (input.id.includes('Star')) {
            data[input.id] = input.getAttribute('data-val');
        } else {
            data[input.id] = input.value;
        }
    });
    localStorage.setItem('lastwar_sim_data', JSON.stringify(data));
}

function loadAllData() {
    const saved = localStorage.getItem('lastwar_sim_data');
    if (!saved) return false;
    const data = JSON.parse(saved);
    for (let id in data) {
        let el = document.getElementById(id);
        if (el) {
            if (id.includes('Star')) {
                el.setAttribute('data-val', data[id]);
                updateStarDisplay(el, parseInt(data[id]));
            } else {
                el.value = data[id];
            }
        }
    }
    return true;
}

function resetAllData() {
    if(confirm("å…¨ã¦ã®å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’æ¶ˆå»ã—ã¦åˆæœŸå€¤ã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ")) {
        localStorage.removeItem('lastwar_sim_data');
        location.reload();
    }
}

// --- æ—¢å­˜ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’å¾®èª¿æ•´ ---
function animateValue(obj, start, end, duration, isPercent = false) {
    let startTimestamp = null;
    const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        const easeOut = 1 - Math.pow(1 - progress, 3);
        let current = start + (end - start) * easeOut;
        if (isPercent) { obj.innerHTML = (current >= 0 ? "+" : "") + current.toFixed(1); }
        else { obj.innerHTML = Math.floor(current).toLocaleString(); }
        if (progress < 1) window.requestAnimationFrame(step);
        else { obj.innerHTML = isPercent ? (end >= 0 ? "+" : "") + end.toFixed(1) : Math.floor(end).toLocaleString(); }
    };
    window.requestAnimationFrame(step);
}

function updateStarDisplay(el, val) {
    let stars = ""; for (let i = 0; i < 5; i++) stars += (i < val) ? "â˜…" : "â˜†";
    el.value = stars;
    if (val === 5) el.style.color = "#e74c3c";
    else if (val > 0) el.style.color = "#f39c12";
    else el.style.color = "#95a5a6";
}

function stepHQ(delta) {
    let el = document.getElementById('hqLevel');
    let newVal = Math.min(Math.max(parseInt(el.value) + delta, 1), 35);
    el.value = newVal; 
    updateHQ(true); // æ‰‹å‹•å¤‰æ›´æ™‚ã¯ãƒ¬ãƒ™ãƒ«ã‚‚åˆã‚ã›ã‚‹
}

function updateHQ(isManual = false) {
    let hqVal = parseInt(document.getElementById('hqLevel').value) || 30;
    let maxHeroLevel = hqVal * 5;
    ['cLevel', 'tLevel'].forEach(id => {
        let el = document.getElementById(id);
        el.setAttribute('max', maxHeroLevel);
        document.getElementById(id + 'Label').innerText = `ğŸ‘¤ Lv (1~${maxHeroLevel})`;
        if (isManual || parseInt(el.value) > maxHeroLevel) el.value = maxHeroLevel;
    });
    calculate();
}

function step(id, delta) {
    let el = document.getElementById(id);
    let isStar = id.includes('Star');
    let val = parseInt(isStar ? el.getAttribute('data-val') : el.value) || 0;
    let min = parseInt(el.getAttribute('min')) || 0;
    let max = parseInt(el.getAttribute('max')) || 999;
    let newVal = Math.min(Math.max(val + delta, min), max);
    if (isStar) { el.setAttribute('data-val', newVal); updateStarDisplay(el, newVal); }
    else el.value = newVal;
    calculate();
}

function getGearMultiplier(gearLevel, stars, type) {
    let baseBoost = 0.025 + (gearLevel * 0.00125);
    let starBoost = [0, 0.025, 0.075, 0.1, 0.15, 0.23][stars] || 0;
    let passiveMulti = 1.0;
    if (stars === 5) {
        if (type === 'gun') passiveMulti = 1.10;
        if (type === 'radar') passiveMulti = 1.30;
        if (type === 'armor') passiveMulti = 1.15;
        if (type === 'data') passiveMulti = 1.05;
    }
    return { statMulti: 1.0 + baseBoost + starBoost, passiveMulti: passiveMulti };
}

let lastB = 0, lastA = 0, lastP = 0;

function calculate() {
    const gears = ['Gun', 'Data', 'Armor', 'Radar'];
    ['c', 't'].forEach(p => {
        gears.forEach(g => {
            let lvEl = document.getElementById(p+g+'Lv');
            let sEl = document.getElementById(p+g+'Star');
            let wrap = sEl.closest('.stepper');
            if (parseInt(lvEl.value) < 40) { 
                sEl.setAttribute('data-val', 0); updateStarDisplay(sEl, 0); wrap.classList.add('disabled'); 
            } else { wrap.classList.remove('disabled'); }
        });
    });
    const calc = (p) => {
        let lv = parseInt(document.getElementById(p+'Level').value);
        let wp = parseInt(document.getElementById(p+'Weapon').value);
        let baseStat = (lv / 175) * 1000;
        let m = gears.map(g => getGearMultiplier(parseInt(document.getElementById(p+g+'Lv').value), parseInt(document.getElementById(p+g+'Star').getAttribute('data-val')), g.toLowerCase()));
        let gearStat = m[0].statMulti * m[1].statMulti * ((m[2].statMulti + m[3].statMulti)/2);
        let gearPass = m.reduce((acc, cur) => acc * cur.passiveMulti, 1);
        let wpStat = 1.0 + (wp * 0.01);
        let wpSkill = [1, 1.05, 1.2, 1.4][Math.floor(wp/10)] || 1;
        let totalM = gearStat * gearPass * wpStat * wpSkill;
        return { score: baseStat * totalM, base: Math.round(baseStat), multi: totalM.toFixed(2) };
    };
    let resB = calc('c'), resA = calc('t');
    animateValue(document.getElementById("scoreBefore"), lastB, resB.score, 400);
    animateValue(document.getElementById("scoreAfter"), lastA, resA.score, 400);
    document.getElementById("detailBefore").innerHTML = `ç´ ã®çŠ¶æ…‹: <b>${resB.base}</b> (Lv175=1000åŸºæº–)<br>ç·åˆãƒãƒ•: <b style="color:#2980b9;">x${resB.multi}</b>`;
    document.getElementById("detailAfter").innerHTML = `ç´ ã®çŠ¶æ…‹: <b>${resA.base}</b> (Lv175=1000åŸºæº–)<br>ç·åˆãƒãƒ•: <b style="color:#c0392b;">x${resA.multi}</b>`;
    let diff = ((resA.score - resB.score) / resB.score) * 100;
    animateValue(document.getElementById("growthNum"), lastP, diff, 400, true);
    lastB = resB.score; lastA = resA.score; lastP = diff;
    
    // è¨ˆç®—ãŒçµ‚ã‚ã‚‹ãŸã³ã«è‡ªå‹•ä¿å­˜
    saveAllData();
}

window.onload = () => { 
    // ä¿å­˜ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã°èª­ã¿è¾¼ã¿ã€ãªã‘ã‚Œã°åˆæœŸåŒ–
    if (!loadAllData()) {
        updateHQ(); 
    } else {
        updateHQ(false); // ä¿å­˜ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æ™‚ã¯ãƒ¬ãƒ™ãƒ«ã‚’ä¸Šæ›¸ãã—ãªã„
    }
};
</script>
</body>

</html>
