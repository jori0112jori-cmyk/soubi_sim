<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ãƒ©ã‚¹ãƒˆã‚¦ã‚©ãƒ¼è‚²æˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
<style>
    /* å…¨ä½“ã®ãƒ™ãƒ¼ã‚¹è¨­å®š */
    body { font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif; background-color: #f0f4f8; color: #333; padding: 10px; padding-bottom: 120px; margin: 0; }
    h1 { font-size: 1.2rem; text-align: center; color: #2c3e50; margin-bottom: 15px; line-height: 1.4; }
    .container { max-width: 1000px; margin: 0 auto; }
    
    .panel { background: #fff; padding: 12px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 15px; }
    .grid { display: flex; gap: 12px; flex-wrap: wrap; }
    
    .card { flex: 1; min-width: 100%; background: #fff; padding: 12px 8px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); box-sizing: border-box;}
    @media (min-width: 768px) { .card { min-width: calc(50% - 10px); padding: 20px 15px; } }
    
    .card-before { border-top: 6px solid #7f8c8d; }
    .card-after { border-top: 6px solid #e74c3c; background: linear-gradient(to bottom, #fffafb, #ffffff); }
    .panel-header { display: flex; justify-content: space-between; align-items: center; margin-top: 0; color: #2980b9; border-bottom: 2px solid #ecf0f1; padding-bottom: 8px; font-size: 1rem; }
    
    /* ãƒ©ãƒ™ãƒ«è¨­å®šï¼ˆè¦–èªæ€§ç¶­æŒï¼‰ */
    label { display: block; margin-top: 10px; margin-bottom: 4px; font-weight: 900; font-size: 0.92rem; color: #333; height: 1.2rem; line-height: 1.2rem; white-space: nowrap; overflow: hidden; }

    /* ã‚¹ãƒ†ãƒƒãƒ‘ãƒ¼è¨­å®šï¼ˆè¦‹åˆ‡ã‚Œé˜²æ­¢ï¼‰ */
    .stepper { display: flex; align-items: center; background: #fff; border: 1px solid #ccd1d9; border-radius: 8px; overflow: hidden; height: 38px; width: 100%; box-sizing: border-box; }
    
    .stepper button { 
        width: 28px; /* æœ€å°å¹…ã‚’ã•ã‚‰ã«ç¸®å° */
        height: 100%; border: none; background: #eef2f5; font-size: 1.2rem; font-weight: bold; color: #34495e; cursor: pointer; touch-action: manipulation; flex-shrink: 0;
    }
    @media (min-width: 360px) { .stepper button { width: 34px; } }
    @media (min-width: 400px) { .stepper button { width: 38px; } }

    .stepper input { flex: 1; text-align: center; border: none; font-size: 16px; font-weight: bold; color: #2c3e50; min-width: 0; background: transparent; height: 100%; padding: 0; }
    
    /* æ˜Ÿè¡¨ç¤ºï¼ˆæ¥µå°ç”»é¢å¯¾å¿œï¼‰ */
    .stepper input[readonly] { font-size: 12px; letter-spacing: -2px; padding-left: 1px; }

    .stepper.disabled { opacity: 0.4; pointer-events: none; background-color: #ecf0f1; }

    /* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ¯”ç‡èª¿æ•´ï¼ˆè¦‹åˆ‡ã‚Œå¯¾ç­–ã®é»„é‡‘æ¯”ï¼‰ */
    .gear-row { display: grid; grid-template-columns: 1.6fr 1fr; gap: 6px; margin-bottom: 5px; align-items: end; }
    
    .result { margin-top: 20px; padding: 12px; border-radius: 10px; text-align: center; border: 1px solid #eee; background-color: #f8f9fa;}
    .res-after { background-color: #faeaeb; border-color: #fadbd8; }
    .score { font-size: 1.8rem; font-weight: bold; margin: 5px 0; font-family: "Arial Black", Arial, sans-serif; }
    .score-b { color: #7f8c8d; }
    .score-a { color: #c0392b; }
    
    .detail-text { font-size: 0.75rem; color: #444; line-height: 1.5; text-align: left; padding: 10px; background: #fff; border-radius: 8px; margin-top: 10px; border-left: 4px solid #3498db; }
    .res-after .detail-text { border-left-color: #e74c3c; } 
    
    .diff-wrapper { position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%); width: calc(100% - 20px); max-width: 970px; z-index: 1000; }
    .diff { font-size: 1.1rem; color: #e74c3c; font-weight: bold; text-align: center; padding: 12px; background: rgba(255, 250, 250, 0.95); backdrop-filter: blur(5px); border-radius: 12px; border: 2px solid #fadbd8; box-shadow: 0 5px 15px rgba(231, 76, 60, 0.15); }
    .reset-btn { font-size: 0.65rem; background: #ecf0f1; color: #7f8c8d; border: none; padding: 3px 6px; border-radius: 4px; }
</style>
</head>
<body>

<div class="container">
    <h1>è‚²æˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼<br><span style="font-size: 0.8rem; color: #7f8c8d;">(è¦‹åˆ‡ã‚Œèª¿æ•´ æœ€çµ‚ç‰ˆ)</span></h1>

    <div class="panel">
        <h3 class="panel-header">ğŸ¢ å…±é€šè¨­å®š <button class="reset-btn" onclick="resetAllData()">ãƒªã‚»ãƒƒãƒˆ</button></h3>
        <label>æœ¬éƒ¨ãƒ¬ãƒ™ãƒ« (MAX 35)</label>
        <div class="stepper" style="max-width: 150px;">
            <button type="button" onclick="stepHQ(-1)">-</button>
            <input type="number" id="hqLevel" value="30" min="1" max="35" onchange="updateHQ()">
            <button type="button" onclick="stepHQ(1)">+</button>
        </div>
    </div>

    <div class="grid">
        <div class="card card-before">
            <h3 class="panel-header" style="color:#7f8c8d;">1. ç¾åœ¨</h3>
            <div class="gear-row" style="grid-template-columns: 1fr 1fr;">
                <div><label id="cLevelLabel">ğŸ‘¤ Lv</label><div class="stepper"><button onclick="step('cLevel', -1)">-</button><input type="number" id="cLevel" value="150" min="1" onchange="calculate()"><button onclick="step('cLevel', 1)">+</button></div></div>
                <div><label>âš”ï¸ æ­¦è£…Lv</label><div class="stepper"><button onclick="step('cWeapon', -1)">-</button><input type="number" id="cWeapon" value="20" min="0" max="30" onchange="calculate()"><button onclick="step('cWeapon', 1)">+</button></div></div>
            </div>
            <div style="margin-top:15px; padding-top:10px; border-top:1px dashed #ccc;">
                <div class="gear-row">
                    <div><label>ğŸ”« å¤§ç ² Lv</label><div class="stepper"><button onclick="step('cGunLv', -1)">-</button><input type="number" id="cGunLv" value="40" min="0" max="40" onchange="calculate()"><button onclick="step('cGunLv', 1)">+</button></div></div>
                    <div><label>â˜…æ®µéš</label><div class="stepper"><button onclick="step('cGunStar', -1)">-</button><input type="text" id="cGunStar" data-val="0" value="â˜†â˜†â˜†â˜†â˜†" readonly><button onclick="step('cGunStar', 1)">+</button></div></div>
                </div>
                <div class="gear-row">
                    <div><label>ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ Lv</label><div class="stepper"><button onclick="step('cDataLv', -1)">-</button><input type="number" id="cDataLv" value="40" min="0" max="40" onchange="calculate()"><button onclick="step('cDataLv', 1)">+</button></div></div>
                    <div><label>â˜…æ®µéš</label><div class="stepper"><button onclick="step('cDataStar', -1)">-</button><input type="text" id="cDataStar" data-val="0" value="â˜†â˜†â˜†â˜†â˜†" readonly><button onclick="step('cDataStar', 1)">+</button></div></div>
                </div>
                <div class="gear-row">
                    <div><label>ğŸ›¡ï¸ è£…ç”² Lv</label><div class="stepper"><button onclick="step('cArmorLv', -1)">-</button><input type="number" id="cArmorLv" value="20" min="0" max="40" onchange="calculate()"><button onclick="step('cArmorLv', 1)">+</button></div></div>
                    <div><label>â˜…æ®µéš</label><div class="stepper"><button onclick="step('cArmorStar', -1)">-</button><input type="text" id="cArmorStar" data-val="0" value="â˜†â˜†â˜†â˜†â˜†" readonly><button onclick="step('cArmorStar', 1)">+</button></div></div>
                </div>
                <div class="gear-row">
                    <div><label>ğŸ“¡ ï¾šï½°ï¾€ï¾ï½° Lv</label><div class="stepper"><button onclick="step('cRadarLv', -1)">-</button><input type="number" id="cRadarLv" value="20" min="0" max="40" onchange="calculate()"><button onclick="step('cRadarLv', 1)">+</button></div></div>
                    <div><label>â˜…æ®µéš</label><div class="stepper"><button onclick="step('cRadarStar', -1)">-</button><input type="text" id="cRadarStar" data-val="0" value="â˜†â˜†â˜†â˜†â˜†" readonly><button onclick="step('cRadarStar', 1)">+</button></div></div>
                </div>
            </div>
            <div class="result res-before"><div class="score score-b" id="scoreBefore">0</div><div class="detail-text" id="detailBefore"></div></div>
        </div>

        <div class="card card-after">
            <h3 class="panel-header" style="color:#c0392b;">2. ç›®æ¨™</h3>
            <div class="gear-row" style="grid-template-columns: 1fr 1fr;">
                <div><label id="tLevelLabel">ğŸ‘¤ Lv</label><div class="stepper"><button onclick="step('tLevel', -1)">-</button><input type="number" id="tLevel" value="150" min="1" onchange="calculate()"><button onclick="step('tLevel', 1)">+</button></div></div>
                <div><label>âš”ï¸ æ­¦è£…Lv</label><div class="stepper"><button onclick="step('tWeapon', -1)">-</button><input type="number" id="tWeapon" value="20" min="0" max="30" onchange="calculate()"><button onclick="step('tWeapon', 1)">+</button></div></div>
            </div>
            <div style="margin-top:15px; padding-top:10px; border-top:1px dashed #ccc;">
                <div class="gear-row">
                    <div><label>ğŸ”« å¤§ç ² Lv</label><div class="stepper"><button onclick="step('tGunLv', -1)">-</button><input type="number" id="tGunLv" value="40" min="0" max="40" onchange="calculate()"><button onclick="step('tGunLv', 1)">+</button></div></div>
                    <div><label>â˜…æ®µéš</label><div class="stepper"><button onclick="step('tGunStar', -1)">-</button><input type="text" id="tGunStar" data-val="2" value="â˜…â˜…â˜†â˜†â˜†" readonly><button onclick="step('tGunStar', 1)">+</button></div></div>
                </div>
                <div class="gear-row">
                    <div><label>ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ Lv</label><div class="stepper"><button onclick="step('tDataLv', -1)">-</button><input type="number" id="tDataLv" value="40" min="0" max="40" onchange="calculate()"><button onclick="step('tDataLv', 1)">+</button></div></div>
                    <div><label>â˜…æ®µéš</label><div class="stepper"><button onclick="step('tDataStar', -1)">-</button><input type="text" id="tDataStar" data-val="0" value="â˜†â˜†â˜†â˜†â˜†" readonly><button onclick="step('tDataStar', 1)">+</button></div></div>
                </div>
                <div class="gear-row">
                    <div><label>ğŸ›¡ï¸ è£…ç”² Lv</label><div class="stepper"><button onclick="step('tArmorLv', -1)">-</button><input type="number" id="tArmorLv" value="40" min="0" max="40" onchange="calculate()"><button onclick="step('tArmorLv', 1)">+</button></div></div>
                    <div><label>â˜…æ®µéš</label><div class="stepper"><button onclick="step('tArmorStar', -1)">-</button><input type="text" id="tArmorStar" data-val="0" value="â˜†â˜†â˜†â˜†â˜†" readonly><button onclick="step('tArmorStar', 1)">+</button></div></div>
                </div>
                <div class="gear-row">
                    <div><label>ğŸ“¡ ï¾šï½°ï¾€ï¾ï½° Lv</label><div class="stepper"><button onclick="step('tRadarLv', -1)">-</button><input type="number" id="tRadarLv" value="40" min="0" max="40" onchange="calculate()"><button onclick="step('tRadarLv', 1)">+</button></div></div>
                    <div><label>â˜…æ®µéš</label><div class="stepper"><button onclick="step('tRadarStar', -1)">-</button><input type="text" id="tRadarStar" data-val="5" value="â˜…â˜…â˜…â˜…â˜…" readonly><button onclick="step('tRadarStar', 1)">+</button></div></div>
                </div>
            </div>
            <div class="result res-after"><div class="score score-a" id="scoreAfter">0</div><div class="detail-text" id="detailAfter"></div></div>
        </div>
    </div>
</div>

<div class="diff-wrapper"><div class="diff" id="growthDiff">ç´„ <span id="growthNum">0</span>% ã‚¢ãƒƒãƒ—ï¼</div></div>

<script>
function saveAllData() {
    const data = {};
    document.querySelectorAll('input').forEach(input => {
        data[input.id] = input.id.includes('Star') ? input.getAttribute('data-val') : input.value;
    });
    localStorage.setItem('lastwar_sim_data', JSON.stringify(data));
}
function loadAllData() {
    const saved = localStorage.getItem('lastwar_sim_data');
    if (!saved) return false;
    const data = JSON.parse(saved);
    for (let id in data) {
        let el = document.getElementById(id);
        if (el) {
            if (id.includes('Star')) { el.setAttribute('data-val', data[id]); updateStarDisplay(el, parseInt(data[id])); }
            else { el.value = data[id]; }
        }
    }
    return true;
}
function resetAllData() {
    if(confirm("ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–ã—ã¾ã™ã‹ï¼Ÿ")) { localStorage.removeItem('lastwar_sim_data'); location.reload(); }
}
function animateValue(obj, start, end, duration, isPercent = false) {
    let startTimestamp = null;
    const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        const easeOut = 1 - Math.pow(1 - progress, 3);
        let current = start + (end - start) * easeOut;
        obj.innerHTML = isPercent ? (current >= 0 ? "+" : "") + current.toFixed(1) : Math.floor(current).toLocaleString();
        if (progress < 1) window.requestAnimationFrame(step);
        else obj.innerHTML = isPercent ? (end >= 0 ? "+" : "") + end.toFixed(1) : Math.floor(end).toLocaleString();
    };
    window.requestAnimationFrame(step);
}
function updateStarDisplay(el, val) {
    let stars = ""; for (let i = 0; i < 5; i++) stars += (i < val) ? "â˜…" : "â˜†";
    el.value = stars;
    if (val === 5) el.style.color = "#e74c3c";
    else if (val > 0) el.style.color = "#f39c12";
    else el.style.color = "#95a5a6";
}
function stepHQ(delta) {
    let el = document.getElementById('hqLevel');
    el.value = Math.min(Math.max(parseInt(el.value) + delta, 1), 35);
    updateHQ(true);
}
function updateHQ(isManual = false) {
    let hqVal = parseInt(document.getElementById('hqLevel').value) || 30;
    let maxHL = hqVal * 5;
    ['cLevel', 'tLevel'].forEach(id => {
        let el = document.getElementById(id);
        el.setAttribute('max', maxHL);
        document.getElementById(id + 'Label').innerText = `ğŸ‘¤ Lv (1~${maxHL})`;
        if (isManual || parseInt(el.value) > maxHL) el.value = maxHL;
    });
    calculate();
}
function step(id, delta) {
    let el = document.getElementById(id);
    let isStar = id.includes('Star');
    let val = parseInt(isStar ? el.getAttribute('data-val') : el.value) || 0;
    let min = parseInt(el.getAttribute('min')) || 0;
    let max = parseInt(el.getAttribute('max')) || 999;
    let newVal = Math.min(Math.max(val + delta, min), max);
    if (isStar) { el.setAttribute('data-val', newVal); updateStarDisplay(el, newVal); }
    else el.value = newVal;
    calculate();
}
function getGearMultiplier(gearLevel, stars, type) {
    let baseBoost = 0.025 + (gearLevel * 0.00125);
    let starBoost = [0, 0.025, 0.075, 0.1, 0.15, 0.23][stars] || 0;
    let passiveMulti = 1.0;
    if (stars === 5) {
        if (type === 'gun') passiveMulti = 1.10;
        if (type === 'radar') passiveMulti = 1.30;
        if (type === 'armor') passiveMulti = 1.15;
        if (type === 'data') passiveMulti = 1.05;
    }
    return { statMulti: 1.0 + baseBoost + starBoost, passiveMulti: passiveMulti };
}
let lastB = 0, lastA = 0, lastP = 0;
function calculate() {
    const gears = ['Gun', 'Data', 'Armor', 'Radar'];
    ['c', 't'].forEach(p => {
        gears.forEach(g => {
            let lvEl = document.getElementById(p+g+'Lv');
            let sEl = document.getElementById(p+g+'Star');
            if (parseInt(lvEl.value) < 40) { sEl.setAttribute('data-val', 0); updateStarDisplay(sEl, 0); sEl.closest('.stepper').classList.add('disabled'); }
            else sEl.closest('.stepper').classList.remove('disabled');
        });
    });
    const calc = (p) => {
        let lv = parseInt(document.getElementById(p+'Level').value), wp = parseInt(document.getElementById(p+'Weapon').value);
        let baseStat = (lv / 175) * 1000;
        let m = gears.map(g => getGearMultiplier(parseInt(document.getElementById(p+g+'Lv').value), parseInt(document.getElementById(p+g+'Star').getAttribute('data-val')), g.toLowerCase()));
        let gearStat = m[0].statMulti * m[1].statMulti * ((m[2].statMulti + m[3].statMulti)/2);
        let gearPass = m.reduce((acc, cur) => acc * cur.passiveMulti, 1);
        let wpMulti = (1.0 + (wp * 0.01)) * ([1, 1.05, 1.2, 1.4][Math.floor(wp/10)] || 1);
        let totalM = gearStat * gearPass * wpMulti;
        return { score: baseStat * totalM, base: Math.round(baseStat), multi: totalM.toFixed(2) };
    };
    let resB = calc('c'), resA = calc('t');
    animateValue(document.getElementById("scoreBefore"), lastB, resB.score, 400);
    animateValue(document.getElementById("scoreAfter"), lastA, resA.score, 400);
    document.getElementById("detailBefore").innerHTML = `ç´ : <b>${resB.base}</b> / å€ç‡: <b style="color:#2980b9;">x${resB.multi}</b>`;
    document.getElementById("detailAfter").innerHTML = `ç´ : <b>${resA.base}</b> / å€ç‡: <b style="color:#c0392b;">x${resA.multi}</b>`;
    let diff = ((resA.score - resB.score) / resB.score) * 100;
    animateValue(document.getElementById("growthNum"), lastP, diff, 400, true);
    lastB = resB.score; lastA = resA.score; lastP = diff;
    saveAllData();
}
window.onload = () => { if (!loadAllData()) updateHQ(); else updateHQ(false); };
</script>
</body>
</html>
